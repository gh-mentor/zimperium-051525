This code has a deadlock problem.
1) Identify the cause of the issue, and use Copilot to fix it.
2) Add XML comments to the code.
3) Add a test case to check the fix.
